---
title: Что такое Web Workers?
description: Это механизм в JavaScript, который позволяет запускать фоновый поток для выполнения тяжёлых или длительных операций без блокировки основного UI.
---

**Web Worker** — это механизм в JavaScript, который позволяет запускать **фоновый поток** для выполнения тяжёлых или длительных операций **без блокировки основного UI**.

<Mermaid
  chart="
flowchart LR
  A[Основной поток] -->|UI рендеринг| B[Пользовательский интерфейс]
  A -->|Создает| C[Web Worker]
  C -->|Вычисления| D[Фоновый поток]
  C -->|postMessage| A
"
/>

С помощью Web Workers можно:
- выполнять сложные вычисления,
- обрабатывать большие массивы данных,
- работать с canvas или WebAssembly,
- и при этом не замораживать интерфейс.

---

## Что не умеет Web Worker?

- Не имеет доступа к DOM
- Не может обращаться к `window`, `document`, `alert`, `localStorage`
- Может работать **только через сообщения** (message passing)

---

## Пример: создание Web Worker

### worker.js — скрипт для воркера

```javascript
// worker.js
self.onmessage = function (e) {
  const result = e.data * 2;
  postMessage(result); // отправляем ответ обратно
};
```

### main.js — основной скрипт

```javascript
// main.js
const worker = new Worker('worker.js');

worker.onmessage = function (e) {
  console.log('Ответ от воркера:', e.data);
};

worker.postMessage(21); // Отправляем данные воркеру
```

<Mermaid
  chart="
sequenceDiagram
  participant Main as Основной поток
  participant Worker as Web Worker
  
  Main->>Worker: postMessage(21)
  Worker->>Worker: Обработка данных (21 * 2)
  Worker->>Main: postMessage(42)
  Main->>Main: console.log('Ответ: 42')
"
/>

В этом примере `21` отправляется воркеру, он обрабатывает и возвращает `42`.

---

## Преимущества Web Workers

<Mermaid
  chart="
pie title Преимущества Web Workers
  'Асинхронность' : 40
  'Производительность' : 35
  'Обмен сообщениями' : 25
"
/>

- **Асинхронность**: тяжелые задачи выполняются без заморозки интерфейса
- **Производительность**: можно распараллелить обработку данных
- **Обмен сообщениями**: простой API через postMessage

---

## API Web Workers

| **Метод/событие**          | **Назначение**                          |
|----------------------------|-----------------------------------------|
| `new Worker(url)`          | Создание воркера                       |
| `worker.postMessage()`     | Отправка данных воркеру                |
| `worker.onmessage`         | Получение данных из воркера            |
| `worker.terminate()`       | Принудительная остановка воркера       |
| `self.onmessage`           | Обработка входящих данных внутри воркера |
| `postMessage()`            | Отправка ответа из воркера в основной поток |

---

## Где применять Web Workers?

<Mermaid
  chart="
graph TD
  A[Web Workers] --> B[Обработка данных]
  A --> C[Графика]
  A --> D[Сжатие]
  A --> E[Криптография]
  A --> F[Парсинг]
  A --> G[Machine Learning]
  B --> H[Большие массивы]
  C --> I[Canvas/WebGL]
  F --> J[JSON/CSV]
  G --> K[WebAssembly]
"
/>

- **Обработка больших массивов данных**
- **Генерация графики, рендеринг**
- **Сжатие изображений**
- **Криптография**
- **Парсинг больших JSON/CSV**
- **Machine Learning в браузере (через WebAssembly + Worker)**

---

## Минусы и ограничения

<Mermaid
  chart="
stateDiagram-v2
  [*] --> Ограничения
  Ограничения --> СложнаяОтладка: Отладка сложнее
  Ограничения --> НетДоступа: Нет доступа к DOM
  Ограничения --> CORS: Работают по CORS
"
/>

- Отладка сложнее, чем обычного JS
- Нет доступа к DOM/Window
- Работают **по CORS**, лучше запускать с сервера

## Вывод
Web Workers — мощный инструмент для вынесения ресурсоемких задач в фоновые потоки, что позволяет сохранять отзывчивость интерфейса при выполнении сложных вычислений.
